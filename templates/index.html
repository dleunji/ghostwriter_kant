<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/style.css">
    <title>Ghostwriter Kant</title>
    <script src="https://kit.fontawesome.com/fb1f288996.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>

    <div class="page">
        <div class="header">
            <div class="title">Ghostwriter Kant</div>
        </div>
        <div class="contents">
            <div class="explanation">
                <div class="img">
                    <img class="kant" src="../static/images/kant.jpg">
                </div>
                <div class="help">
                    Hello I'm Immanuel Kant.<br>
                    It was pretty hard to understand my papers, right?<br>
                    Don't worry about your essay.<br>
                    I'm gonna be your own ghostwriter.<br>
                    Just let me know how to get started!<br>
                </div>
            </div>
            <div class="box">
                <div class="loader"></div>
            </div>
            <div class="search-box">
                <div class="prefix-box">
                    <input type="text" id="prefix" name="prefix" placeholder="It starts with..." required>
                    <div class="search-btn" id="search" type="submit" onclick="submit()">
                        <!-- 검색버튼 -->
                        <i class="fas fa-search"></i>
                    </div>
                    <div type="button" class="cancel-btn" id="reset" onclick="reset()">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class ="essay"></div>
    </div>
    </div>
    <script>
        function reset() {
            var prefix = document.getElementById("prefix");
            prefix.value = "";
        }
        // enter
        var input = document.getElementById("prefix");
        input.addEventListener("keyup", function(event) {
            if(event.keyCode == 13){
                event.preventDefault();
                document.getElementById("search").click();
            }
        });
        //click search button
        function submit(){
            var prefix = document.getElementById("prefix");
            var prefix_value = prefix.value;
            if (prefix_value == ""){
                alert('Please let me know how to get started!');
                return;
            }
            var formData = new FormData();
            formData.append("context", prefix_value);
            $(".loader").css('display','flex');

            fetch(
                "/gpt2", 
                {
                    method: "POST",
                    body : formData
                }
            )
            .then(response => {
                if(response.status == 200){
                    return response;
                }
                else if(response.status == 400){
                    throw Error("Failed1");
                }
                else {
                    throw Error("Failed2");
                }
            })
            .then(response => {
                res = response.json()
                return res
            })
            .then(response => {
                var text = response['text'] + "...<br>Now it's your turn!<br><br><br>";
                console.log(text);
                $(".loader").css('display','none');
                document.getElementsByClassName("essay")[0].innerHTML = text;
            })
            .catch(e => {
                var result = document.getElementsByClassName("essay")[0];
                result.textContent = e;
            })
        }
    </script>
</body>

</html>